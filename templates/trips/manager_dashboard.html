{% extends 'base.html' %}

{% block title %}Manager Dashboard - Transport Management System{% endblock %}

{% block content %}
<h2>Manager Dashboard</h2>
<p>System overview and key metrics</p>

<!-- Key Metrics Grid -->
<div class="dashboard-grid">
    <div class="dashboard-card">
        <h3>Active Trips</h3>
        <div class="value">{{ active_trips }}</div>
        <p>Trips currently in progress or scheduled</p>
    </div>
    
    <div class="dashboard-card">
        <h3>Completed This Month</h3>
        <div class="value">{{ completed_this_month }}</div>
        <p>Trips completed successfully this month</p>
    </div>
    
    <div class="dashboard-card">
        <h3>Vehicles Due Maintenance</h3>
        <div class="value">{{ vehicles_due_maintenance }}</div>
        <p>Vehicles requiring maintenance within 7 days</p>
    </div>
    
    <div class="dashboard-card">
        <h3>Vehicles in Maintenance</h3>
        <div class="value">{{ vehicles_in_maintenance }}</div>
        <p>Vehicles currently unavailable</p>
    </div>
</div>

<!-- Financial Summary -->
<div class="dashboard-grid">
    <div class="dashboard-card" style="border-left-color: #27ae60;">
        <h3>Income This Month</h3>
        <div class="value" style="color: #27ae60;">${{ income_this_month|floatformat:2 }}</div>
        <p>Total freight income</p>
    </div>
    
    <div class="dashboard-card" style="border-left-color: #e74c3c;">
        <h3>Expenses This Month</h3>
        <div class="value" style="color: #e74c3c;">${{ expenses_this_month|floatformat:2 }}</div>
        <p>Total operational expenses</p>
    </div>
    
    <div class="dashboard-card" style="border-left-color: {% if net_profit >= 0 %}#27ae60{% else %}#e74c3c{% endif %};">
        <h3>Net Profit This Month</h3>
        <div class="value" style="color: {% if net_profit >= 0 %}#27ae60{% else %}#e74c3c{% endif %};">
            {% if net_profit >= 0 %}+{% endif %}${{ net_profit|floatformat:2 }}
        </div>
        <p>Income minus expenses</p>
    </div>
</div>

<!-- Recent Trips -->
<h3 class="mt-2">Recent Trips</h3>
{% if recent_trips %}
    <table>
        <thead>
            <tr>
                <th>Trip Number</th>
                <th>Client</th>
                <th>Driver</th>
                <th>Vehicle</th>
                <th>Scheduled Date</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for trip in recent_trips|slice:":10" %}
                <tr>
                    <td><strong>{{ trip.trip_number }}</strong></td>
                    <td>{{ trip.client_name }}</td>
                    <td>{{ trip.driver.get_full_name|default:trip.driver.username }}</td>
                    <td>{{ trip.vehicle.registration_plate }}</td>
                    <td>{{ trip.scheduled_datetime|date:"M d, Y H:i" }}</td>
                    <td>
                        <span class="status-badge status-{{ trip.status|slugify }}">
                            {{ trip.status }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'trip-detail' trip.pk %}" class="btn btn-primary btn-sm">View</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="text-center mt-1">
        <a href="{% url 'trip-list' %}" class="btn">View All Trips</a>
        <a href="{% url 'financial-summary' %}" class="btn btn-success">View Financial Summary</a>
    </div>
{% else %}
    <div class="message info">
        No recent trips found.
    </div>
{% endif %}
{% endblock %}